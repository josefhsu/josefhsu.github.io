<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>成語接龍五子棋</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f0f0f0;
        }
		#game-container {
		    display: flex;
		    flex-direction: column;
		    align-items: center;
		    max-width: 1200px;
		    margin: 0 auto;
		    padding: 20px;
		}

		@media (min-width: 768px) {
		    #game-container {
		        flex-direction: row;
		        justify-content: space-between;
		        align-items: flex-start;
		    }
		    #left-panel, #center-panel, #right-panel {
		        margin: 0 10px;  /* 這會在每個面板的兩側添加 10px 的間距，總共 20px */
		    }
		}

		#left-panel, #right-panel {
		    width: 100%;
		    max-width: 300px;
		    margin-bottom: 20px;
		}

		#center-panel {
		    width: 100%;
		    max-width: 500px;
		    text-align: center;
		}
        }
        #board {
            display: grid;
            grid-template-columns: repeat(12, 1fr);
            gap: 1px;
            background-color: #ddd;
            border: 1px solid #999;
            margin: 0 auto;
        }
        .cell {
            aspect-ratio: 1;
            background-color: #fff;
            border: 1px solid #ccc;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 14px;
            cursor: pointer;
        }
        .warning {
            border: 2px solid yellow;
        }
        .player-section {
            margin-bottom: 20px;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
        .player-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            margin: 0 auto;
        }
        .score {
            font-size: 18pt;
            margin: 10px 0;
        }
        #rules {
            text-align: left;
            font-size: 14px;
        }
        #start-button, #computer-play {
            font-size: 16px;
            padding: 10px 20px;
            margin-top: 10px;
            cursor: pointer;
        }
        input, button {
            margin: 5px;
            padding: 5px;
        }
        #timer {
            font-size: 24px;
            font-weight: bold;
            margin-top: 10px;
        }
        #version-info {
            position: fixed;
            bottom: 10px;
            right: 10px;
            font-size: 12px;
            color: #666;
        }

        @media (min-width: 768px) {
            #game-container {
                flex-direction: row;
                justify-content: center;
                align-items: flex-start;
            }
            #left-panel, #right-panel {
                margin-top: 100px;
            }
            .score {
                font-size: 22pt;
            }
        }

        @media (max-width: 767px) {
            .cell {
                font-size: 12px;
            }
            #board {
                max-width: 100%;
            }
        }
    </style>
</head>
<body>
    <div id="game-container">
        <div id="left-panel">
            <div class="player-section">
                <div class="player-avatar" style="background-color: blue;"></div>
                <div class="score">玩家1分數: <span id="score1">0</span></div>
                <input type="text" id="char-input1" maxlength="1" placeholder="玩家1輸入">
                <button onclick="placeCharacter(1)">放置</button>
            </div>
            <div class="player-section">
                <div class="player-avatar" style="background-color: red;"></div>
                <div class="score">玩家2分數: <span id="score2">0</span></div>
                <input type="text" id="char-input2" maxlength="1" placeholder="玩家2輸入">
                <button onclick="placeCharacter(2)">放置</button>
            </div>
        </div>
        <div id="center-panel">
            <h1>成語接龍五子棋</h1>
            <div id="board"></div>
            <p id="message"></p>
            <p id="timer">60</p>
            <button id="start-button" onclick="startGame()">開始遊戲</button>
            <button id="computer-play" onclick="toggleComputerPlay()">電腦對戰</button>
        </div>
        <div id="right-panel">
            <h2>遊戲規則</h2>
            <div id="rules">
                <ol>
                    <li>遊戲開始時，中央格子會出現一個隨機字符。</li>
                    <li>玩家輪流選擇一個與已有字符相鄰的空格，輸入一個字。</li>
                    <li>玩家1的字符為藍色，玩家2的字符為紅色。</li>
                    <li>每放置一個字得1分。</li>
                    <li>形成四字成語（不分顏色）額外得2分。</li>
                    <li>首先形成五個連續同色字符的玩家獲勝。</li>
                    <li>每回合有60秒時間限制，超時則輸。</li>
                    <li>黃色邊框表示該位置形成活三或死四。</li>
                </ol>
            </div>
        </div>
    </div>
    
    <div id="version-info"></div>


    <script>
		let isComputerPlay = false;

		function toggleComputerPlay() {
		    isComputerPlay = !isComputerPlay;
		    document.getElementById('computer-play').textContent = isComputerPlay ? '取消電腦對戰' : '電腦對戰';
		    if (isComputerPlay) {
		        document.getElementById('char-input2').disabled = true;
		        document.querySelector('button[onclick="placeCharacter(2)"]').disabled = true;
		    } else {
		        document.getElementById('char-input2').disabled = false;
		        document.querySelector('button[onclick="placeCharacter(2)"]').disabled = false;
		    }
		    if (gameStarted && currentPlayer === 2 && isComputerPlay) {
		        setTimeout(computerPlay, 1000);
		    }
		}

		function startGame() {
		    if (gameStarted) return;
		    gameStarted = true;
		    initializeBoard();
		    setFirstCharacter();
		    startTimer();
		    document.getElementById('start-button').disabled = true;
		    setMessage("遊戲開始！玩家1先行");
		    if (isComputerPlay) {
		        document.getElementById('char-input2').disabled = true;
		        document.querySelector('button[onclick="placeCharacter(2)"]').disabled = true;
		    }
		}

		function placeCharacter(player) {
		    if (!gameStarted || player !== currentPlayer) return;
		    if (!selectedCell) {
		        setMessage("請先選擇一個格子");
		        return;
		    }

		    const char = document.getElementById(`char-input${player}`).value;
		    if (char.length !== 1) {
		        setMessage("請輸入一個字");
		        return;
		    }

		    const row = parseInt(selectedCell.dataset.row);
		    const col = parseInt(selectedCell.dataset.col);

		    if (!isValidPlacement(row, col)) {
		        setMessage("無效的放置位置，必須與已有的字相連");
		        return;
		    }

		    board[row][col] = char;
		    selectedCell.textContent = char;
		    selectedCell.style.color = player === 1 ? 'blue' : 'red';

		    // 增加基本得分
		    scores[player - 1] += 1;

		    // 檢查成語得分
		    checkIdiomScore(row, col);

		    updateScores();

		    if (checkWin(row, col, player)) {
		        setMessage(`玩家 ${player} 獲勝！`);
		        endGame();
		    } else {
		        currentPlayer = 3 - currentPlayer;  // 切換玩家 (1 -> 2, 2 -> 1)
		        setMessage(`輪到玩家 ${currentPlayer}`);
		        resetTimer();
		        if (isComputerPlay && currentPlayer === 2) {
		            setTimeout(computerPlay, 1000);
		        }
		    }

		    selectedCell.style.backgroundColor = '#fff';
		    selectedCell = null;
		    document.getElementById(`char-input${player}`).value = '';

		    checkWarnings();
		}

		function computerPlay() {
		    if (!gameStarted || currentPlayer !== 2 || !isComputerPlay) return;

		    const emptyCells = [];
		    for (let i = 0; i < size; i++) {
		        for (let j = 0; j < size; j++) {
		            if (board[i][j] === '' && isValidPlacement(i, j)) {
		                emptyCells.push([i, j]);
		            }
		        }
		    }
		    if (emptyCells.length > 0) {
		        const [row, col] = emptyCells[Math.floor(Math.random() * emptyCells.length)];
		        selectedCell = document.querySelector(`[data-row="${row}"][data-col="${col}"]`);
		        document.getElementById('char-input2').value = characters[Math.floor(Math.random() * characters.length)];
		        placeCharacter(2);
		    }
		}

		// 確保在遊戲結束時重置電腦對戰狀態
		function endGame() {
		    gameStarted = false;
		    clearInterval(timerInterval);
		    document.getElementById('start-button').disabled = false;
		    if (isComputerPlay) {
		        document.getElementById('char-input2').disabled = false;
		        document.querySelector('button[onclick="placeCharacter(2)"]').disabled = false;
		    }
		}
    </script>
</body>
</html>